<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Android TV Pro</title>
    
    <link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
    <script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root { --primary: #ff0000; --bg: #000; }
        body { background: var(--bg); color: #fff; margin: 0; overflow: hidden; font-family: sans-serif; }

        /* ভিডিও প্লেয়ার এলাকা */
        .video-wrapper { width: 100%; height: 100vh; position: absolute; top: 0; left: 0; }
        .video-js { width: 100% !important; height: 100% !important; }

        /* চ্যানেল লিস্ট */
        .channel-list { 
            position: absolute; bottom: 0; width: 100%; height: 30vh;
            display: flex; overflow-x: auto; padding: 20px 40px; gap: 20px; 
            background: linear-gradient(to top, rgba(0,0,0,1), transparent);
            align-items: center; transition: 0.5s; z-index: 99;
            scroll-behavior: smooth;
        }

        .channel-card {
            min-width: 220px; height: 130px; background: rgba(40,40,40,0.8);
            border-radius: 15px; border: 4px solid #333; position: relative;
            cursor: pointer; outline: none; transition: 0.3s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* রিমোট ফোকাস ও দুলন্ত স্টার */
        .channel-card:focus { border-color: var(--primary); transform: scale(1.1); background: #111; }
        
        .fav-star { 
            position: absolute; top: 10px; right: 10px; color: #ffca28; 
            font-size: 1.5rem; display: none; animation: dangle 2s infinite ease-in-out;
        }
        .is-fav .fav-star { display: block; }

        @keyframes dangle {
            0%, 100% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
        }

        .channel-list::-webkit-scrollbar { display: none; }
        .hide-ui { transform: translateY(100%); }
    </style>
</head>
<body onclick="showUI()">

<div class="video-wrapper">
    <video id="tv-player" class="video-js vjs-default-skin" controls preload="auto" autoplay data-setup='{}'></video>
</div>

<div class="channel-list" id="channelList"></div>

<script>
    const playlistUrl = 'https://raw.githubusercontent.com/soheltanver85-a11y/Live-tv2/refs/heads/main/Live-tv2';
    let player = videojs('tv-player');
    let channels = [], favorites = JSON.parse(localStorage.getItem('favs')) || [];
    let uiTimer, pressTimer;

    async function loadApp() {
        try {
            const res = await fetch(playlistUrl);
            const data = await res.text();
            const lines = data.split('\n');
            
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith('#EXTINF')) {
                    const name = lines[i].split(',')[1] || "Channel";
                    const url = lines[i + 1]?.trim();
                    if(url) channels.push({ name, url });
                }
            }
            renderUI();
        } catch (e) { alert("প্লেলিস্ট লোড হচ্ছে না!"); }
    }

    function renderUI() {
        const list = document.getElementById('channelList');
        list.innerHTML = '';

        // ফেভারিট চ্যানেলগুলোকে শুরুতে নিয়ে আসা
        let sortedChannels = [...channels].sort((a, b) => {
            return favorites.includes(b.url) - favorites.includes(a.url);
        });

        sortedChannels.forEach((ch, index) => {
            const isFav = favorites.includes(ch.url);
            const card = document.createElement('div');
            card.className = `channel-card ${isFav ? 'is-fav' : ''}`;
            card.tabIndex = 0;
            card.innerHTML = `<i class="fa-solid fa-star fav-star"></i><div style="font-weight:bold">${ch.name}</div>`;

            card.onfocus = () => {
                showUI();
                player.src({ type: 'application/x-mpegURL', src: ch.url });
                player.play();
                card.scrollIntoView({ behavior: "smooth", inline: "center" });
            };

            // লং প্রেস লজিক (রিমোটের OK বাটন ১ সেকেন্ড ধরে রাখলে)
            card.addEventListener('keydown', (e) => {
                showUI();
                if (e.key === 'Enter') {
                    pressTimer = setTimeout(() => toggleFav(ch.url), 1000);
                }
                if (e.key === 'ArrowRight') card.nextSibling?.focus();
                if (e.key === 'ArrowLeft') card.previousSibling?.focus();
            });

            card.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') clearTimeout(pressTimer);
            });

            list.appendChild(card);
        });

        // প্রথম চ্যানেলে ফোকাস
        setTimeout(() => document.querySelector('.channel-card').focus(), 1000);
    }

    function toggleFav(url) {
        if (favorites.includes(url)) favorites = favorites.filter(f => f !== url);
        else favorites.push(url);
        localStorage.setItem('favs', JSON.stringify(favorites));
        renderUI(); // লিস্ট রিফ্রেশ
    }

    function showUI() {
        document.getElementById('channelList').classList.remove('hide-ui');
        clearTimeout(uiTimer);
        uiTimer = setTimeout(() => {
            document.getElementById('channelList').classList.add('hide-ui');
        }, 7000);
    }

    loadApp();
</script>
</body>
</html>
